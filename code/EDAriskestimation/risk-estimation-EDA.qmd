---
title: "DSAN-5300-Project-Group2"
author: "Yiwei Qi"
date: last-modified
date-format: long
editor: visual
format:
  html:
    embed-resources: true
execute:
    echo: true
    warning: false
    message: false
    freeze: auto
---

# DSAN-5300-Project-Group2

## Risk Estimation Clean

```{r}
# Load library for R
library(tidyverse)
```

```{r}
# Read the file
data <- read.csv('../../dataset/risk_estimation_clean.csv', header = TRUE)

```

```{r}
library(tidyverse)
library(gridExtra)
library(grid) 
library(ggplot2)
data_numeric <- data %>%
  mutate(across(everything(), ~ as.numeric(as.character(.)))) %>%
  select_if(~ !any(is.na(.)))
predictive_variables <- setdiff(names(data), c("cancer", "other_non_predictive_variables","count"))

create_plot <- function(var_name, data) {
  cancer_rates <- data %>%
    group_by(!!sym(var_name)) %>%
    summarise(Cancer_Rate = mean(cancer, na.rm = TRUE)) %>%
    ungroup() %>%
    mutate(Variable = factor(!!sym(var_name), levels = unique(!!sym(var_name))))

  ggplot(cancer_rates, aes(x = Variable, y = Cancer_Rate)) +
    geom_line(aes(group = 1)) +
    geom_point(aes(color = Variable), size = 1) +
    scale_color_viridis_d() +
    labs(x = var_name, y = NULL) +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8),
      axis.text.y = element_text(size = 8),
      plot.title = element_text(size = 10, hjust = 0.5),
      legend.position = "none"
    )
}

plot_list <- lapply(predictive_variables, function(var) create_plot(var, data))

n_cols <- 3
n_rows <- ceiling(length(plot_list) / n_cols)
grid_plots <- gridExtra::grid.arrange(grobs = plot_list, ncol = n_cols, nrow = n_rows)

```

This graph shows the relationship between multiple variables and breast cancer incidence. For example, the "agegrp" variable shows the incidence of breast cancer in different age groups, the "density" variable shows the incidence at different breast densities, and the color-coded points represent the incidence at each level.

Using this graph, we can discover variables that are more likely to be associated with breast cancer. For example, "lastmamm" and "invasive" appear to have strong correlations with breast cancer, while conversely, "agegroup" trend not large, suggesting that this variablp may not be very critical in predicting breast cancer risk.

```{r}
library(corrplot)
library(RColorBrewer)


correlations_with_cancer <- cor(data_numeric, use = "complete.obs")['cancer',]
significant_vars <- names(which(abs(correlations_with_cancer) > 0.01))

selected_data <- data_numeric[, significant_vars]
cor_matrix <- cor(selected_data, use = "complete.obs")

corrplot(cor_matrix, method = "color", type = "upper",
         order = "hclust", tl.col = "black",
         col = colorRampPalette(brewer.pal(n = 11, name = "RdYlBu"))(200),
         title = "Correlation Matrix of Variables Related to Cancer",
         mar = c(2, 2, 2, 2))
```

This graph shows how a range of variables are related to cancer risk. In this heat map, blue represents a negative correlation, that is, as one variable increases, the other variable decreases; yellow represents a positive correlation, that is, both variables change in the same direction. The darker the color, the stronger the correlation.

As can be seen from this figure, there is a strong positive correlation between invasive and cancer. Lastmanmm, race and Hispanic also show a certain correlation with cancer.

```{r}

library(tidyverse)
library(ggplot2)
library(RColorBrewer)

generate_heatmap <- function(data, var1, var2) {
  heatmap_data <- data %>%
    group_by(!!sym(var1), !!sym(var2)) %>%
    summarise(cancer_rate = mean(cancer, na.rm = TRUE), .groups = "drop") %>%
    ungroup()

  ggplot(heatmap_data, aes(x = !!sym(var1), y = !!sym(var2), fill = cancer_rate)) +
    geom_tile() +
    scale_fill_gradientn(colors = brewer.pal(9, "Spectral")) +
    labs(title = paste("Cancer Rate by", var1, "and", var2), x = var1, y = var2) +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, vjust = 1),
      axis.text.y = element_text(angle = 45, hjust = 1),
      plot.title = element_text(size = 14, face = "bold")
    ) +
    coord_fixed(ratio = 1)
}


variable_pairs <- list(
  c("invasive", "lastmamm"),
  c("invasive", "race"),
  c("invasive", "Hispanic"),
  c("lastmamm", "race"),
  c("lastmamm", "Hispanic"),
  c("race", "Hispanic")
)

for(pair in variable_pairs) {
  plot <- generate_heatmap(data, pair[1], pair[2])
  print(plot)
}



```

In the previous part, we found that invasive, Lastmanmm, race and Hispanic showed correlation with cancer in the heat map. In this part, we explore the relationship between combinations of different variables and cancer. It can be seen that some specific combinations have much higher cancer rates than others.
